<!DOCTYPE html>
<html lang="hr">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">

<meta property="og:title" content="Referendum 2013" />
<meta property="og:description"
	content="Odgovorite na referendumsko pitanje i saznajte što su odgovorili vaši prijatelji." />
<meta property="og:type" content="website" />
<meta property="og:url" content="http://referendum2013.hr" />
<meta property="og:image"
	content="http://res.cloudinary.com/gruggred/image/upload/v1385124248/logo_ytxr78.png" />
<meta property="og:site_name" content="Referendum 2013" />
<meta property="fb:app_id" content="1407261166178158" />
<meta id="mediaSlideKeywords" name="keywords"
	content="referendum, 2013, brak"></meta>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>referendum2013.hr</title>

<link rel="shortcut icon"
	href="http://getbootstrap.com/docs-assets/ico/favicon.png">
<link rel="stylesheet"
	href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">
<link rel="stylesheet"
	href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap-theme.min.css">

<link href="{{ STATIC_URL }}django_facebook/css/facebook.css"
	type="text/css" rel="stylesheet" media="all" />


<style type="text/css">
#logo {
	text-align: center;
	vertical-align: baseline;
	margin-top: 20px;
}

.header-logo {
	display: inline-block;
	height: auto;
	max-width: 100%;
	line-height: 1.42857;
	transition: all 0.2s ease-in-out 0s;
}

#login {
	vertical-align: baseline;
	margin-top: 20px;
}

.jumbotron {
	text-align: center;
}

.pagination-centered {
	text-align: center;
}

.text-disclaimer {
	text-align: justify;
}

.text-question {
	text-align: justify;
}
</style>

{% block extra_head %}{% endblock %}
</head>
<body>
	<div id="fb-root"></div>
	<script>
		(function(d, s, id) {
			var js, fjs = d.getElementsByTagName(s)[0];
			if (d.getElementById(id))
				return;
			js = d.createElement(s);
			js.id = id;
			js.src = "//connect.facebook.net/hr_HR/all.js#xfbml=1&appId=1407261166178158";
			fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));
	</script>

	<div class="navbar navbar-default navbar-static-top" role="navigation">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse"
					data-target=".navbar-collapse">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="http://referendum2013.hr">referendum2013.hr</a>
			</div>
			<nav class="navbar-collapse bs-navbar-collapse collapse"
				role="navigation" style="height: 1px;">
				{% if user.is_authenticated %}
				<div class="nav navbar-nav navbar-right">
					<a class="btn btn-default navbar-btn navbar-right"
						href="{% url 'auth_logout' %}?next={{ request.path|urlencode }}">Odlogiraj
						se</a>
				</div>
				{% endif %}
			</nav>
		</div>
	</div>


	<div class="container">		

		<div class="row">
			<div class="col-sm-4">
				<div class="row text-center">
					<img src="http://res.cloudinary.com/gruggred/image/upload/v1385219322/logo_1_ze0cjf.png" alt="referendum2013.hr"
						class="header-logo" />
				</div>
			</div>

			{% if not user.is_authenticated %}

			<div id="login" class="col-sm-8">
				<!-- <div class="jumbotron">  -->
				<div class="well">
					<h2>Referendum 2013</h2>
					<p class="lead">Prijavite se putem Facebooka, glasajte i saznajte
						što vaši prijatelji i ostali misle o ovoj temi.</p>
					<!--form to call registration via facebook -->
					<form action="{% url 'facebook_connect' %}" method="post">
						{% csrf_token %} <input type="hidden" value="{{ request.path }}"
							name="next" />
						<p>
							<a class="btn btn-lg btn-default" role="button"
								onclick="F.connect(this.parentNode.parentNode); return false;">Prijavite
								se putem Facebooka</a>
						</p>
					</form>
					<div class="fb-like" data-href="http://referendum2013.hr"
						data-width="200" data-layout="standard" data-action="like"
						data-show-faces="true" data-share="true"></div>
					<div class="fb-share-button" data-href="http://referendum2013.hr" data-width="200" data-type="button_count"></div>


				</div>
				<div class="panel panel-default">
					<div class="panel-body text-disclaimer">
						<h5>
							<small>
								<p class="muted">U svrhu ovoga istraživanja prikupljamo
									podatke o vašem stavu o referendumskom pitanju, kao i određene
									podatke s Facebooka (godinu rođenja, lokaciju, spol i popis vaših
									prijatelja), čime želimo dobiti uvid u načine kako međusobna
									poznanstva utječu na stavove korisnika Facebooka. Vaš
									individualni odgovor na referendumsko pitanje i podaci o vašem
									profilu neće biti vidljivi drugim korisnicima, već će samo biti
									vidljiv anonimni prosjek odgovora. Jedino ćete vi vidjeti
									prosjek odgovora vaših prijatelja. Istraživači garantiraju da
									prikupljeni podaci neće biti korišteni ni u koje druge svrhe
									osim znanstveno-istraživačke. Prijavom na ovaj upitnik
									potvrđujete da ste suglasni s ovim pravilima korištenja.</p>
							</small>
						</h5>
					</div>
				</div>
			</div>
			{% endif %} 
			
			{% if user.is_authenticated %}
			<div class="col-sm-7 col-sm-offset-1">
				<div class="well">
					<h2>Referendumsko pitanje</h2>
					<p class="lead text-question">Jeste li za to da se u Ustav Republike Hrvatske unese
							odredba po kojoj je brak životna zajednica žene i muškarca?</p>
					<!--form to call registration via facebook -->
					<button id="btn_yes" class="btn btn-large btn btn-success" type="button">Za</button>
					<button id="btn_no" class="btn btn-large btn btn-danger" type="button">Protiv</button>

					<form id="form_vote" action="{% url 'referendum:vote' %}"
						method="post">
						{% csrf_token %} <input type="hidden" id="input_vote"
							name="choice" value="-1">
					</form>
					{% if vote.vote == 1 %}
					<p>Glasali ste ZA!</p>
					{% elif vote.vote == 0 %}
					<p>Glasali ste PROTIV!</p>
					{% else %}
					<p>Glasajte!</p>
					{% endif %}

					<div class="fb-like" data-href="http://referendum2013.hr"
						data-width="200" data-layout="standard" data-action="like"
						data-show-faces="true" data-share="true"></div>
						
					<div class="fb-share-button" data-href="http://referendum2013.hr" data-width="200" data-type="button_count"></div>

				</div>


			</div>

			{% endif %}
		
		</div>
	</div>

	<hr />
	<div class="container">
		
		{% if not user.is_authenticated %}

		<div class="col-md-12 text-center">
			<h2>Trenutni rezultati</h2>
			<svg id="chart_global_results"></svg>
		</div>

		{% endif %}

		{% if user.is_authenticated %}

		<div class="col-md-6 text-center">
			<h2>Trenutni rezultati</h2>
			<svg id="chart_global_results"></svg>
		</div>

		<div class="col-md-6 text-center">
			<h2>Trenutni rezultati vaših prijatelja</h2>
			<svg id="chart_friends_results"></svg>
		</div>

		{% endif %}

	</div>

	<hr />
	<div class="container">
		<!-- Example row of columns -->
		<div class="row">
			<div class="col-md-6">
				<h2>O Projektu</h2>
				<p>Ova web stranica predstavlja dio znanstvenoga istraživanja u
					području socijalnih mreža. Cilj je ovoga istraživanja utvrditi kako
					stav okoline utječe na stav pojedinca te kako se širi vijest u
					socijalnim mrežama.</p>

			</div>
			<div class="col-md-6">
				<h2>O Nama</h2>
				<p>Ova web stranica predstavlja dio znanstvenoga istraživanja u
					području socijalnih mreža. Cilj je ovoga istraživanja utvrditi kako
					stav okoline utječe na stav pojedinca te kako se širi vijest u
					socijalnim mrežama.</p>
			</div>
		</div>


		<hr />

		<footer>
			<p>©referendum2013.hr</p>
		</footer>

		<input type="hidden" id="global_results" value="{{ global_results }}">
	</div>
	<!-- /container -->
	<!-- 
<script type="text/javascript">
var max = -1;
$('.row > div').each(function() {
var h = $(this).height(); 
max = h > max ? h : max;
        
$(this).css({'min-height': max});
});
</script>
 -->
	<script
		src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script>
	function draw_piechart(data, svg)
	{
		var width = 300,
		    height = 300,
		    radius = Math.min(width, height) / 2;

		// var data = [{"label": "protiv", "value": 1},
		//             {"label": "za", "value": 1}
		//             ];

		var total_votes = data[0].value + data[1].value;

		var color_za = d3.rgb(55,148,48);
		var color_protiv = d3.rgb(241,27,27);
		var color_prazno = d3.rgb(200,200,200);

		var svg = svg
		    .attr("width", width)
		    .attr("height", height)
		  .append("g")
		    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

		var arc_zero = d3.svg.arc()
		    .innerRadius(radius - 0.45*radius)
		    .outerRadius(radius - 0.05*radius)
		    .startAngle(0);

		var path_zero = svg.append("path")
		          .datum({endAngle: 2*Math.PI})
		          .attr("fill", color_prazno)
		          .attr("d", arc_zero)
		          .classed("prazan");

		if (total_votes >= 3 )
		{

		var ratio_protiv = data[0].value / total_votes;
		var ratio_za = data[1].value / total_votes;

		var percentage_protiv = ratio_protiv *100;
		var percentage_za = ratio_za *100;

		var t = data[0].value % total_votes;
		if(t != 0 && (t < total_votes / 2)) {
		  percentage_za += 1;
		  } else if(t != 0) {
		  percentage_protiv += 1; }


		var arc = d3.svg.arc()
		    .innerRadius(radius - 0.45*radius)
		    .outerRadius(radius - 0.05*radius);

		var za_arc = svg.append("path")
		    .datum({startAngle: 2*Math.PI, endAngle: 2*Math.PI})
		    .attr("fill", color_za)
		    .attr("d", arc)
		    .transition()
		    .duration(2000)
		    .attrTween("d", function(d) {
		      var interpolate = d3.interpolate(d.endAngle, ratio_protiv*2*Math.PI);
		          return function(t) {
		            d.endAngle = interpolate(t);
		            return arc(d);
		            }
		      });

		var protiv_arc = svg.append("path")
		    .datum({startAngle: 0, endAngle: 0})
		    .attr("fill", color_protiv)
		    .attr("d", arc)
		    .transition()
		    .duration(1500)
		    .attrTween("d", function(d) {
		      var interpolate = d3.interpolate(d.endAngle, ratio_protiv*2*Math.PI);
		          return function(t) {
		            d.endAngle = interpolate(t);
		            return arc(d);
		            }
		      });

		svg.append("text")
		    .attr("dy", ".75em")
		    .attr("y", -0.15*radius )
		    .attr("x", 0 )
		    .attr("text-anchor", "middle")
		    .attr("font-family","sans-serif")
		    .attr("font-size","22px")
		    .attr("fill",color_za)
		    .text("0")
		    .transition()
		    .duration(2000)
		    .tween("text", 
		      function() {
		          var i = d3.interpolate(this.textContent, Math.floor(percentage_za));
		      return function(t) {
		              this.textContent = "ZA " + Math.round(i(t)) + "%";
		              };
		      });

		svg.append("text")
		    .attr("dy", ".75em")
		    .attr("y", 0.05*radius )
		    .attr("x", 0 )
		    .attr("text-anchor", "middle")
		    .attr("font-family","sans-serif")
		    .attr("font-size","22px")
		    .attr("fill",color_protiv)
		    .text("0")
		    .transition()
		    .duration(2000)
		    .tween("text", 
		      function() {
		          var i = d3.interpolate(this.textContent, Math.floor(percentage_protiv));
		      return function(t) {
		              this.textContent = "PROTIV " + Math.round(i(t)) + "%";
		              };
		      });

		}
		else
		{

		  svg.append("text")
		    .attr("y", -0.15*radius )
		    .attr("x", 0 )
		    .attr("text-anchor", "middle")
		    .attr("font-family","sans-serif")
		    .attr("font-size","22px")
		    .attr("fill",color_prazno)
		    .text("Nema dosta");

		  svg.append("text")
		    .attr("y", 0.05*radius )
		    .attr("x", 0 )
		    .attr("text-anchor", "middle")
		    .attr("font-family","sans-serif")
		    .attr("font-size","22px")
		    .attr("fill",color_prazno)
		    .text("podataka za");

		  svg.append("text")
		    .attr("y", 0.25*radius )
		    .attr("x", 0 )
		    .attr("text-anchor", "middle")
		    .attr("font-family","sans-serif")
		    .attr("font-size","22px")
		    .attr("fill",color_prazno)
		    .text("prijatelje:-(");
		}
	}
	</script>

	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script>
		$(document).ready(function() {
			results = jQuery.parseJSON("{{ global_results }}".replace(/&#39;/g,"\""));
			draw_aggreated_results(results, d3.select("#chart_global_results"));

		
			friends_results = jQuery.parseJSON("{{ friends_results }}".replace(/&#39;/g,"\""));
						
			if(friends_results!=-1)
			{
				draw_aggreated_results(friends_results, d3.select("#chart_friends_results"));	
			}
		
		});

		function draw_aggreated_results(results, chart)
		{
			var mod_results = [
				{'label': 'protiv', 'value': 0},
				{'label': 'za', 'value': 0},
			];

			if(results.length >= 1)
			{
				mod_results[results[0].vote].value = Number(results[0].vote_count);	
			}
			if(results.length == 2)
			{				
				mod_results[results[1].vote].value = Number(results[1].vote_count);	
			}		

			draw_piechart(mod_results, chart);
		}
	</script>

	<script>
		$("#btn_yes").click(function(e) {
			$("#input_vote").val(1);
			$("#form_vote").submit();
		});

		$("#btn_no").click(function(e) {
			$("#input_vote").val(0);
			$("#form_vote").submit();
		});
	</script>
	

	<script
		src="//netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js"></script>
	
	{% include 'django_facebook/_facebook_js.html' %}
</body>
</html>
